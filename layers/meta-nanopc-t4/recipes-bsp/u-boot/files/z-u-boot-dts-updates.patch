From d2c693684f2efe77e0841ceac4695122ad0a9946 Mon Sep 17 00:00:00 2001
From: Viswanathan M <viswanathan.m@adlinktech.com>
Date: Wed, 11 Dec 2019 17:10:59 +0530
Subject: [PATCH] dts modifications for u-boot

---
 arch/arm/dts/lec-px30.dtsi    | 2275 +++++++++++++++++++++++++++++++++++++++++
 arch/arm/dts/px30-evb.dts     |   39 +-
 arch/arm/dts/px30-u-boot.dtsi |   34 +-
 3 files changed, 2314 insertions(+), 34 deletions(-)
 create mode 100644 arch/arm/dts/lec-px30.dtsi


diff --git a/arch/arm/dts/px30-evb.dts b/arch/arm/dts/px30-evb.dts
index bf1c857..e4af2da 100644
--- a/arch/arm/dts/px30-evb.dts
+++ b/arch/arm/dts/px30-evb.dts
@@ -5,13 +5,14 @@
  */
 
 /dts-v1/;
-#include "px30.dtsi"
+#include "lec-px30.dtsi"
 #include "px30-evb-u-boot.dtsi"
 #include <dt-bindings/input/input.h>
 
 / {
-	model = "Rockchip PX30 EVB";
-	compatible = "rockchip,px30-evb", "rockchip,px30";
+
+	model = "ADLINK ARM, LEC-PX30";
+        compatible = "adlink,lec-px30";
 
 	adc-keys {
 		u-boot,dm-pre-reloc;
@@ -97,6 +98,18 @@
 		regulator-always-on;
 		regulator-boot-on;
 	};
+
+	vcc_sd_pwr: sdmmc-regulator {
+                compatible = "regulator-fixed";
+                pinctrl-names = "default";
+                pinctrl-0 = <&sdmmc_pwr>;
+                /*gpio = <&gpio0 2 GPIO_ACTIVE_HIGH>;*/
+                regulator-name = "vcc_sd_pwr";
+                regulator-min-microvolt = <3300000>;
+                regulator-max-microvolt = <3300000>;
+                /*startup-delay-us = <100000>;*/
+        };
+
 };
 
 &gmac {
@@ -395,15 +408,13 @@
 	sd-uhs-sdr50;
 	sd-uhs-sdr104;
 	vqmmc-supply = <&vccio_sd>;
-	vmmc-supply = <&vcc_sd>;
-	status = "okay";
-};
-
-&crypto {
+	vmmc-supply =<&sdmmc_pwr>; /*<&vcc_sd>;*/
 	status = "okay";
 };
 
 &emmc {
+	u-boot,dm-pre-reloc;
+	fifo-mode;
 	bus-width = <8>;
 	cap-mmc-highspeed;
 	mmc-hs200-1_8v;
@@ -420,10 +431,6 @@
 	status = "okay";
 };
 
-&uart5 {
-	status = "okay";
-};
-
 &uart2 {
 	status = "okay";
 };
@@ -435,6 +442,14 @@
 			<0 7 RK_FUNC_GPIO &pcfg_pull_up>;
 		};
 	};
+
+	sdmmc_pwr  {
+                sdmmc_pwr: sdmmc_pwr {
+                        rockchip,pins = <0 RK_PA2 RK_FUNC_GPIO &pcfg_output_high>;
+                };
+        };
+
+	
 };
 
 &u2phy {
diff --git a/arch/arm/dts/px30-evb-u-boot.dtsi b/arch/arm/dts/px30-evb-u-boot.dtsi
index 81ed249..ae3e4f9 100644
--- a/arch/arm/dts/px30-evb-u-boot.dtsi
+++ b/arch/arm/dts/px30-evb-u-boot.dtsi
@@ -11,7 +11,6 @@
 	};
 
 	chosen {
-		u-boot,spl-boot-order = &emmc, &sdmmc;
 		stdout-path = &uart2;
 	};
 };
@@ -20,27 +19,22 @@
 	u-boot,dm-pre-reloc;
 };
 
-&uart5 {
-	clock-frequency = <24000000>;
-	u-boot,dm-pre-reloc;
-};
-
 &uart2 {
 	clock-frequency = <24000000>;
 	u-boot,dm-pre-reloc;
 };
 
 &nandc0 {
-	u-boot,dm-spl;
+	u-boot,dm-pre-reloc;
 	status = "okay";
 };
 
 &sdmmc {
-	u-boot,dm-spl;
+	u-boot,dm-pre-reloc;
 };
 
 &emmc {
-	u-boot,dm-spl;
+	u-boot,dm-pre-reloc;
 };
 
 &pmugrf {
@@ -51,54 +45,50 @@
 	u-boot,dm-pre-reloc;
 };
 
-&crypto {
-	u-boot,dm-pre-reloc;
-};
-
 &pmucru {
 	u-boot,dm-pre-reloc;
 };
 
 &saradc {
-	u-boot,dm-spl;
+	u-boot,dm-pre-reloc;
 	status = "okay";
 };
 
 &gpio0 {
-	u-boot,dm-spl;
+	u-boot,dm-pre-reloc;
 	status = "disabled";
 };
 
 &gpio1 {
-	u-boot,dm-spl;
+	u-boot,dm-pre-reloc;
 	status = "disabled";
 };
 
 &gpio2 {
-	u-boot,dm-spl;
+	u-boot,dm-pre-reloc;
 	status = "disabled";
 };
 
 &gpio3 {
-	u-boot,dm-spl;
+	u-boot,dm-pre-reloc;
 	status = "disabled";
 };
 
 &usb20_otg {
-	u-boot,dm-spl;
+	u-boot,dm-pre-reloc;
 };
 
 &usb2phy_grf {
-	u-boot,dm-spl;
+	u-boot,dm-pre-reloc;
 	status = "okay";
 };
 
 &u2phy {
-	u-boot,dm-spl;
+	u-boot,dm-pre-reloc;
 	status = "okay";
 };
 
 &u2phy_otg {
-	u-boot,dm-spl;
+	u-boot,dm-pre-reloc;
 	status = "okay";
 };
-- 
2.7.4

